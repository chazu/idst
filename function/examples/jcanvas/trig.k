;;; sine table as 16.16 fixed-point floats

(define %sines
  (let ((s (malloc 720)))
    (set (short@ s   0) 0)
    (set (short@ s   1) 571)
    (set (short@ s   2) 1143)
    (set (short@ s   3) 1714)
    (set (short@ s   4) 2285)
    (set (short@ s   5) 2855)
    (set (short@ s   6) 3425)
    (set (short@ s   7) 3993)
    (set (short@ s   8) 4560)
    (set (short@ s   9) 5125)
    (set (short@ s  10) 5689)
    (set (short@ s  11) 6252)
    (set (short@ s  12) 6812)
    (set (short@ s  13) 7370)
    (set (short@ s  14) 7927)
    (set (short@ s  15) 8480)
    (set (short@ s  16) 9031)
    (set (short@ s  17) 9580)
    (set (short@ s  18) 10125)
    (set (short@ s  19) 10667)
    (set (short@ s  20) 11206)
    (set (short@ s  21) 11742)
    (set (short@ s  22) 12274)
    (set (short@ s  23) 12803)
    (set (short@ s  24) 13327)
    (set (short@ s  25) 13847)
    (set (short@ s  26) 14364)
    (set (short@ s  27) 14875)
    (set (short@ s  28) 15383)
    (set (short@ s  29) 15885)
    (set (short@ s  30) 16383)
    (set (short@ s  31) 16876)
    (set (short@ s  32) 17363)
    (set (short@ s  33) 17846)
    (set (short@ s  34) 18323)
    (set (short@ s  35) 18794)
    (set (short@ s  36) 19259)
    (set (short@ s  37) 19719)
    (set (short@ s  38) 20173)
    (set (short@ s  39) 20620)
    (set (short@ s  40) 21062)
    (set (short@ s  41) 21497)
    (set (short@ s  42) 21925)
    (set (short@ s  43) 22347)
    (set (short@ s  44) 22761)
    (set (short@ s  45) 23169)
    (set (short@ s  46) 23570)
    (set (short@ s  47) 23964)
    (set (short@ s  48) 24350)
    (set (short@ s  49) 24729)
    (set (short@ s  50) 25100)
    (set (short@ s  51) 25464)
    (set (short@ s  52) 25820)
    (set (short@ s  53) 26168)
    (set (short@ s  54) 26509)
    (set (short@ s  55) 26841)
    (set (short@ s  56) 27165)
    (set (short@ s  57) 27480)
    (set (short@ s  58) 27787)
    (set (short@ s  59) 28086)
    (set (short@ s  60) 28377)
    (set (short@ s  61) 28658)
    (set (short@ s  62) 28931)
    (set (short@ s  63) 29195)
    (set (short@ s  64) 29450)
    (set (short@ s  65) 29696)
    (set (short@ s  66) 29934)
    (set (short@ s  67) 30162)
    (set (short@ s  68) 30381)
    (set (short@ s  69) 30590)
    (set (short@ s  70) 30790)
    (set (short@ s  71) 30981)
    (set (short@ s  72) 31163)
    (set (short@ s  73) 31335)
    (set (short@ s  74) 31497)
    (set (short@ s  75) 31650)
    (set (short@ s  76) 31793)
    (set (short@ s  77) 31927)
    (set (short@ s  78) 32050)
    (set (short@ s  79) 32164)
    (set (short@ s  80) 32269)
    (set (short@ s  81) 32363)
    (set (short@ s  82) 32448)
    (set (short@ s  83) 32522)
    (set (short@ s  84) 32587)
    (set (short@ s  85) 32642)
    (set (short@ s  86) 32687)
    (set (short@ s  87) 32722)
    (set (short@ s  88) 32747)
    (set (short@ s  89) 32762)
    (set (short@ s  90) 32766)
    (set (short@ s  91) 32762)
    (set (short@ s  92) 32747)
    (set (short@ s  93) 32722)
    (set (short@ s  94) 32687)
    (set (short@ s  95) 32642)
    (set (short@ s  96) 32587)
    (set (short@ s  97) 32522)
    (set (short@ s  98) 32448)
    (set (short@ s  99) 32363)
    (set (short@ s 100) 32269)
    (set (short@ s 101) 32164)
    (set (short@ s 102) 32050)
    (set (short@ s 103) 31927)
    (set (short@ s 104) 31793)
    (set (short@ s 105) 31650)
    (set (short@ s 106) 31497)
    (set (short@ s 107) 31335)
    (set (short@ s 108) 31163)
    (set (short@ s 109) 30981)
    (set (short@ s 110) 30790)
    (set (short@ s 111) 30590)
    (set (short@ s 112) 30381)
    (set (short@ s 113) 30162)
    (set (short@ s 114) 29934)
    (set (short@ s 115) 29696)
    (set (short@ s 116) 29450)
    (set (short@ s 117) 29195)
    (set (short@ s 118) 28931)
    (set (short@ s 119) 28658)
    (set (short@ s 120) 28377)
    (set (short@ s 121) 28086)
    (set (short@ s 122) 27787)
    (set (short@ s 123) 27480)
    (set (short@ s 124) 27165)
    (set (short@ s 125) 26841)
    (set (short@ s 126) 26509)
    (set (short@ s 127) 26168)
    (set (short@ s 128) 25820)
    (set (short@ s 129) 25464)
    (set (short@ s 130) 25100)
    (set (short@ s 131) 24729)
    (set (short@ s 132) 24350)
    (set (short@ s 133) 23964)
    (set (short@ s 134) 23570)
    (set (short@ s 135) 23169)
    (set (short@ s 136) 22761)
    (set (short@ s 137) 22347)
    (set (short@ s 138) 21925)
    (set (short@ s 139) 21497)
    (set (short@ s 140) 21062)
    (set (short@ s 141) 20620)
    (set (short@ s 142) 20173)
    (set (short@ s 143) 19719)
    (set (short@ s 144) 19259)
    (set (short@ s 145) 18794)
    (set (short@ s 146) 18323)
    (set (short@ s 147) 17846)
    (set (short@ s 148) 17363)
    (set (short@ s 149) 16876)
    (set (short@ s 150) 16383)
    (set (short@ s 151) 15885)
    (set (short@ s 152) 15383)
    (set (short@ s 153) 14875)
    (set (short@ s 154) 14364)
    (set (short@ s 155) 13847)
    (set (short@ s 156) 13327)
    (set (short@ s 157) 12803)
    (set (short@ s 158) 12274)
    (set (short@ s 159) 11742)
    (set (short@ s 160) 11206)
    (set (short@ s 161) 10667)
    (set (short@ s 162) 10125)
    (set (short@ s 163) 9580)
    (set (short@ s 164) 9031)
    (set (short@ s 165) 8480)
    (set (short@ s 166) 7927)
    (set (short@ s 167) 7370)
    (set (short@ s 168) 6812)
    (set (short@ s 169) 6252)
    (set (short@ s 170) 5689)
    (set (short@ s 171) 5125)
    (set (short@ s 172) 4560)
    (set (short@ s 173) 3993)
    (set (short@ s 174) 3425)
    (set (short@ s 175) 2855)
    (set (short@ s 176) 2285)
    (set (short@ s 177) 1714)
    (set (short@ s 178) 1143)
    (set (short@ s 179) 571)
    (set (short@ s 180) 0)
    (set (short@ s 181) -571)
    (set (short@ s 182) -1143)
    (set (short@ s 183) -1714)
    (set (short@ s 184) -2285)
    (set (short@ s 185) -2855)
    (set (short@ s 186) -3425)
    (set (short@ s 187) -3993)
    (set (short@ s 188) -4560)
    (set (short@ s 189) -5125)
    (set (short@ s 190) -5689)
    (set (short@ s 191) -6252)
    (set (short@ s 192) -6812)
    (set (short@ s 193) -7370)
    (set (short@ s 194) -7927)
    (set (short@ s 195) -8480)
    (set (short@ s 196) -9031)
    (set (short@ s 197) -9580)
    (set (short@ s 198) -10125)
    (set (short@ s 199) -10667)
    (set (short@ s 200) -11206)
    (set (short@ s 201) -11742)
    (set (short@ s 202) -12274)
    (set (short@ s 203) -12803)
    (set (short@ s 204) -13327)
    (set (short@ s 205) -13847)
    (set (short@ s 206) -14364)
    (set (short@ s 207) -14875)
    (set (short@ s 208) -15383)
    (set (short@ s 209) -15885)
    (set (short@ s 210) -16383)
    (set (short@ s 211) -16876)
    (set (short@ s 212) -17363)
    (set (short@ s 213) -17846)
    (set (short@ s 214) -18323)
    (set (short@ s 215) -18794)
    (set (short@ s 216) -19259)
    (set (short@ s 217) -19719)
    (set (short@ s 218) -20173)
    (set (short@ s 219) -20620)
    (set (short@ s 220) -21062)
    (set (short@ s 221) -21497)
    (set (short@ s 222) -21925)
    (set (short@ s 223) -22347)
    (set (short@ s 224) -22761)
    (set (short@ s 225) -23169)
    (set (short@ s 226) -23570)
    (set (short@ s 227) -23964)
    (set (short@ s 228) -24350)
    (set (short@ s 229) -24729)
    (set (short@ s 230) -25100)
    (set (short@ s 231) -25464)
    (set (short@ s 232) -25820)
    (set (short@ s 233) -26168)
    (set (short@ s 234) -26509)
    (set (short@ s 235) -26841)
    (set (short@ s 236) -27165)
    (set (short@ s 237) -27480)
    (set (short@ s 238) -27787)
    (set (short@ s 239) -28086)
    (set (short@ s 240) -28377)
    (set (short@ s 241) -28658)
    (set (short@ s 242) -28931)
    (set (short@ s 243) -29195)
    (set (short@ s 244) -29450)
    (set (short@ s 245) -29696)
    (set (short@ s 246) -29934)
    (set (short@ s 247) -30162)
    (set (short@ s 248) -30381)
    (set (short@ s 249) -30590)
    (set (short@ s 250) -30790)
    (set (short@ s 251) -30981)
    (set (short@ s 252) -31163)
    (set (short@ s 253) -31335)
    (set (short@ s 254) -31497)
    (set (short@ s 255) -31650)
    (set (short@ s 256) -31793)
    (set (short@ s 257) -31927)
    (set (short@ s 258) -32050)
    (set (short@ s 259) -32164)
    (set (short@ s 260) -32269)
    (set (short@ s 261) -32363)
    (set (short@ s 262) -32448)
    (set (short@ s 263) -32522)
    (set (short@ s 264) -32587)
    (set (short@ s 265) -32642)
    (set (short@ s 266) -32687)
    (set (short@ s 267) -32722)
    (set (short@ s 268) -32747)
    (set (short@ s 269) -32762)
    (set (short@ s 270) -32766)
    (set (short@ s 271) -32762)
    (set (short@ s 272) -32747)
    (set (short@ s 273) -32722)
    (set (short@ s 274) -32687)
    (set (short@ s 275) -32642)
    (set (short@ s 276) -32587)
    (set (short@ s 277) -32522)
    (set (short@ s 278) -32448)
    (set (short@ s 279) -32363)
    (set (short@ s 280) -32269)
    (set (short@ s 281) -32164)
    (set (short@ s 282) -32050)
    (set (short@ s 283) -31927)
    (set (short@ s 284) -31793)
    (set (short@ s 285) -31650)
    (set (short@ s 286) -31497)
    (set (short@ s 287) -31335)
    (set (short@ s 288) -31163)
    (set (short@ s 289) -30981)
    (set (short@ s 290) -30790)
    (set (short@ s 291) -30590)
    (set (short@ s 292) -30381)
    (set (short@ s 293) -30162)
    (set (short@ s 294) -29934)
    (set (short@ s 295) -29696)
    (set (short@ s 296) -29450)
    (set (short@ s 297) -29195)
    (set (short@ s 298) -28931)
    (set (short@ s 299) -28658)
    (set (short@ s 300) -28377)
    (set (short@ s 301) -28086)
    (set (short@ s 302) -27787)
    (set (short@ s 303) -27480)
    (set (short@ s 304) -27165)
    (set (short@ s 305) -26841)
    (set (short@ s 306) -26509)
    (set (short@ s 307) -26168)
    (set (short@ s 308) -25820)
    (set (short@ s 309) -25464)
    (set (short@ s 310) -25100)
    (set (short@ s 311) -24729)
    (set (short@ s 312) -24350)
    (set (short@ s 313) -23964)
    (set (short@ s 314) -23570)
    (set (short@ s 315) -23169)
    (set (short@ s 316) -22761)
    (set (short@ s 317) -22347)
    (set (short@ s 318) -21925)
    (set (short@ s 319) -21497)
    (set (short@ s 320) -21062)
    (set (short@ s 321) -20620)
    (set (short@ s 322) -20173)
    (set (short@ s 323) -19719)
    (set (short@ s 324) -19259)
    (set (short@ s 325) -18794)
    (set (short@ s 326) -18323)
    (set (short@ s 327) -17846)
    (set (short@ s 328) -17363)
    (set (short@ s 329) -16876)
    (set (short@ s 330) -16383)
    (set (short@ s 331) -15885)
    (set (short@ s 332) -15383)
    (set (short@ s 333) -14875)
    (set (short@ s 334) -14364)
    (set (short@ s 335) -13847)
    (set (short@ s 336) -13327)
    (set (short@ s 337) -12803)
    (set (short@ s 338) -12274)
    (set (short@ s 339) -11742)
    (set (short@ s 340) -11206)
    (set (short@ s 341) -10667)
    (set (short@ s 342) -10125)
    (set (short@ s 343) -9580)
    (set (short@ s 344) -9031)
    (set (short@ s 345) -8480)
    (set (short@ s 346) -7927)
    (set (short@ s 347) -7370)
    (set (short@ s 348) -6812)
    (set (short@ s 349) -6252)
    (set (short@ s 350) -5689)
    (set (short@ s 351) -5125)
    (set (short@ s 352) -4560)
    (set (short@ s 353) -3993)
    (set (short@ s 354) -3425)
    (set (short@ s 355) -2855)
    (set (short@ s 356) -2285)
    (set (short@ s 357) -1714)
    (set (short@ s 358) -1143)
    (set (short@ s 359) -571)
    s))

(define sin	(lambda (a) (set a (%       a  360)) (if (< a 0) (set a (+ a 360))) (short@ %sines a)))
(define cos	(lambda (a) (set a (% (+ 90 a) 360)) (if (< a 0) (set a (+ a 360))) (short@ %sines a)))

(syntax sin	(lambda (form compiler) `(let ((_a (% ,[form second] 360))) (short@ %sines (if (< _a 0) (+ _a 360) _a)))))
(syntax cos	(lambda (form compiler) `(sin (+ 90 ,[form second]))))

(define *.16
  (lambda (a b)
    (>> (* a b) 16)))
